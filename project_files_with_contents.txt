File Path: /Users/outjet/Sites/radarb/functions/index.js
--------------------------------------------------------------------------------
// The Cloud Functions for Firebase SDK to create Cloud Functions and set up triggers.
const functions = require('firebase-functions');

const fetch = require('node-fetch');
let cachedOhgoApiKey = null;

// The Firebase Admin SDK to access Firestore.
const admin = require('firebase-admin');
admin.initializeApp();

const { SecretManagerServiceClient } = require('@google-cloud/secret-manager');
const client = new SecretManagerServiceClient();

const axios = require('axios');
const cors = require('cors')({ origin: true });

exports.getCameraData = functions.https.onRequest(async (req, res) => {
  const [version] = await client.accessSecretVersion({
    name: 'projects/358874041676/secrets/ohgo-api/versions/latest',
  });
  const ohgoApiKey = version.payload.data.toString();
  cors(req, res, async () => {
    try {
      const latsw = req.query.latsw;
      const lngsw = req.query.lngsw;
      const latne = req.query.latne;
      const lngne = req.query.lngne;

      const API_URL = `https://publicapi.ohgo.com/api/v1/cameras?map-bounds-sw=${latsw},${lngsw}&map-bounds-ne=${latne},${lngne}`;

      const response = await axios.get(API_URL, {
        headers: {
          "Authorization": `APIKEY ${ohgoApiKey}`
        }
      });

      res.set("Access-Control-Allow-Origin", "*");
      res.set("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS");
      res.send(response.data);
      console.log(`ohGoAPI is: ${ohgoApiKey} and response is ${response.data}`);
    } catch (error) {
      res.status(500).send({ error: "Error retrieving data" });
    }
  });
});


async function getOhgoApiKey() {
  if (!cachedOhgoApiKey) {
    const [version] = await client.accessSecretVersion({
      name: 'projects/358874041676/secrets/ohgo-api/versions/latest',
    });
    cachedOhgoApiKey = version.payload.data.toString();
  }
  return cachedOhgoApiKey;
}

exports.getSensorData = functions.https.onRequest(async (req, res) => {
  const ohgoApiKey = await getOhgoApiKey();
  const API_URL = `https://publicapi.ohgo.com/api/v1/weather-sensor-sites?map-bounds-sw=${req.query.latsw},${req.query.lngsw}&map-bounds-ne=${req.query.latne},${req.query.lngne}`;
  const API_KEY = `APIKEY ${ohgoApiKey}`;

  try {
    const response = await axios.get(API_URL, {
      headers: {
        "Authorization": API_KEY
      }
    });

    res.set("Access-Control-Allow-Origin", "*");
    res.send(response.data);
  } catch (error) {
    res.status(500).send({error: "Error retrieving data"});
  }
});

exports.getFlightDelays = functions.https.onRequest(async (req, res) => {
  const [version] = await client.accessSecretVersion({
    name: 'projects/358874041676/secrets/aeroapi/versions/latest',
  });
  const aeroApiKey = version.payload.data.toString();
  cors(req, res, () => {
    res.set("Access-Control-Allow-Origin", "*");
    if (req.method === "OPTIONS") {
      res.set("Access-Control-Allow-Methods", "GET");
      res.set("Access-Control-Allow-Headers", "Content-Type");
      res.status(204).send("");
    } else {
      const airportCode = req.query.airportCode;
      const apiUrl = `https://aeroapi.flightaware.com/aeroapi/airports/delays?airport_code=${airportCode}`;
      const headers = {
        'x-apikey': aeroApiKey
      };

      axios.get(apiUrl, { headers })
      .then(response => response.data)
      .then(data => {
        if (data && data.delays) {
          const delays = data.delays.filter(delay => delay.airport === airportCode);
          if (delays.length > 0) {
            const delayReasons = delays.map(delay => delay.reasons.map(reason => reason.reason)).flat();
            res.status(200).send(delayReasons.join(" | "));
          } else {
            res.status(200).send("");
          }
        } else {
          res.status(200).send(""); // Handle the case where data.delays is not defined
        }
      })
      .catch(error => {
        console.error(error);
        res.status(500).send("Error retrieving flight delays.");
      });    
    }
  });
});

exports.getGroundStopInfo = functions.https.onRequest((req, res) => {
  cors(req, res, () => {
    res.set("Access-Control-Allow-Origin", "*");
    const apiUrl =
      "https://soa.smext.faa.gov/asws/api/airport/status/cle"; 
      process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
    axios.get(apiUrl)
      .then((response) => {
        const data = response.data;
        if (!data.Delay && data.Status[0].Reason === "No known delays for this airport") {
          res.set('Access-Control-Allow-Origin', '*');
          res.status(200).send("");
        } else {
          res.set('Access-Control-Allow-Origin', '*');
          res.status(200).send(data.Status);
        }
      })
      .catch((error) => {
        console.error("Error fetching ground stop information", error);
        res.status(500).send("Error fetching ground stop information");
      });
  });
});

exports.getCityName = functions.https.onRequest(async (req, res) => {
  cors(req, res, async () => {
    try {
      const [version] = await client.accessSecretVersion({
        name: 'projects/358874041676/secrets/google-maps-api/versions/latest',
      });

      const apiKey = version.payload.data.toString();

      const lat = req.query.lat;
      const lng = req.query.lng;

      const url = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lng}&key=${apiKey}`;

      const response = await fetch(url);
      const data = await response.json();

      const addressComponents = data.results[0].address_components;
      const formattedAddress = data.results[0].formatted_address;
      // const locationType = data.results[0].geometry.location_type;
      const premiseType = data.results[0].types[0];

      res.set('Access-Control-Allow-Origin', '*');
      res.send({
        address: formattedAddress,
        premiseType: premiseType,
        address_components: addressComponents,
      });
    } catch (error) {
      console.error(error);
      res.status(500).send('Error retrieving city name.');
    }
  });
});

exports.getWeatherData = functions.https.onRequest(async (req, res) => {
  res.set('Access-Control-Allow-Origin', '*');
  // Handle preflight request
  if (req.method === 'OPTIONS') {
    res.status(204).send('');
    return;
  }

  try {
    const [version] = await client.accessSecretVersion({
      name: 'projects/358874041676/secrets/openweathermap/versions/latest',
      // name: 'projects/358874041676/secrets/openweathermap/versions/1',
    });
    const apiKey = version.payload.data.toString();

    const lat = req.query.lat;
    const lng = req.query.lng;
    console.log(lat, lng);
    const url = `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lng}&exclude=minutely&units=imperial&appid=${apiKey}`;
    console.log(`URL is ${url}`);
    console.error(`URL is ${url}`);
    const response = await fetch(url);
    const data = await response.json();
    
    res.json(data);
  } catch (error) {
    console.error(error);
    console.error(`URL is ${url}`);
    res.status(500).send('Error fetching weather data.');
  }
});



exports.getAmbientWeatherData = functions.https.onRequest(async (req, res) => {
  cors(req, res, async () => {
    try {
      // Replace these with your actual Application Key and API Key
      const applicationKey = '0acb5017ad334b908f7cf4c021d54ce4ef5d9cf6343b41a7bbdf82d1f3c5ed53';
      const apiKey = '965ff6ce58d444609421f58e0198de214d2985bef33844abaa2d89cd404cfb0c';

      const API_URL = `https://api.ambientweather.net/v1/devices?applicationKey=${applicationKey}&apiKey=${apiKey}`;

      const response = await axios.get(API_URL);

      res.set("Access-Control-Allow-Origin", "*");
      res.send(response.data);
    } catch (error) {
      console.error("Error fetching Ambient Weather data", error);
      res.status(500).send({ error: "Error retrieving Ambient Weather data" });
    }
  });
});

const cheerio = require('cheerio');

exports.grabPivotalHRRR6hQPF = functions.https.onRequest(async (req, res) => {
  // Set CORS headers
  res.set('Access-Control-Allow-Origin', '*');

  // Handle preflight OPTIONS request
  if (req.method === 'OPTIONS') {
      res.status(204).send('');
      return;
  }

  try {
      const pageUrl = 'https://www.pivotalweather.com/model.php?m=hrrr&p=qpf_006h-imp&fh=0&r=us_ma&dpdt=&mc=';
      const pageResponse = await axios.get(pageUrl);
      const $ = cheerio.load(pageResponse.data);
      const hrrr6hQPFimageUrl = $('#display_image').attr('src');

      res.send(hrrr6hQPFimageUrl); // Send the image URL as the response
  } catch (error) {
      console.error('Error fetching image URL:', error);
      res.status(500).send('Error fetching image URL');
  }
});
================================================================================

File Path: /Users/outjet/Sites/radarb/package.json
--------------------------------------------------------------------------------
{
  "dependencies": {
    "@google-cloud/secret-manager": "^4.2.1",
    "express": "^4.18.2",
    "firebase-functions": "^4.2.1"
  }
}

================================================================================

File Path: /Users/outjet/Sites/radarb/public/index.html
--------------------------------------------------------------------------------
<!DOCTYPE html>
<html>

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-KLC200B4V5"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;500&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500&display=swap">
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-KLC200B4V5');
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    // Refresh the page every 360 seconds (6 minutes) if it is currently visible
    setInterval(() => {
      if (!document.hidden) {
        window.location.reload();
      }
    }, 360000);
  </script>

  <title>RadarB</title>
  <script src="scripts/app1597.js?v=1" async></script>
  <link rel="stylesheet" href="styles/style.css">

  <base href="https://radarb.web.app/">
</head>

<body>
  <div class="holder-of-the-divs">
    <div id="ambientWeatherDataContainer">
      <div class="pws-box">
        <div class="pws-box-left">
          <div class="current-temperature wxelement">
            <img src="https://radarb.web.app/images/temp.png" alt="Temperature Icon" width="36">
            <p id="current-temperature"></p>
          </div>
          <p id="feelslike-temperature"></p>
          <p id="current-day"></p>
          <p id="current-time"></p>
        </div>
        <div class="pws-box-right">
          <div class="humidity wxelement">
            <img src="https://radarb.web.app/images/humidity.png" alt="Humidity Icon" width="36">
            <p id="humidity"></p>
          </div>
        </div>
        <div class="pws-box-right">
          <div class="wind wxelement">
            <!-- <img src="https://radarb.web.app/images/wind.png" alt="Wind Icon" width="36"> -->
            <div class="wind-indicator-container">
              <div class="wind-arrow" id="windArrow"></div>
            </div>
            <p id="wind"></p>
          </div>
          <p id="windgusts"></p>
        </div>
        <div class="pws-box-right">
          <div class="uv wxelement">
            <img id="uvimg" src="https://radarb.web.app/images/uv.png" alt="UV Icon">
            <p id="uv"></p>
          </div>
        </div>
      </div>
      <div class="weather-refresh" style="display: none;">
        <div class="last-refresh">
          Last Refresh: <span id="refresh-timer">0:00</span>
        </div>
      </div>
      <div class="forecast-container"></div>
    </div>


    <div class="you-are-here" id="you-are-here">
      <!-- <button id="useCurrentLocation">Use Current Location</button>   -->
    </div>
    <div class='alerts-container'>
      <div class="delays-container"><span class="airportDelays"></span></div>
      <div class="ground-stops"></div>
      <div class="crosswind-container"><span class="crosswindAlert"></span></div>
    </div>
    <div class='sensor-container'></div>
    <div class="radar-grid">
      <div>
        <img src="https://cdn.tegna-media.com/wkyc/weather/myownradar/comp/880x495/cleveland15.gif"
          alt="Cleveland Radar">
      </div>
      <div>
        <a target="_blank" href="https://fox8.com/weather/forecast/"><img
            src="https://media.psg.nexstardigital.net/WJW/weather/west.jpg" alt="WJW Radar"></a>
      </div>
      <div>
        <img src="https://sirocco.accuweather.com/nx_mosaic_640x480_public/sir/inmsiroh_.gif" alt="Accuweather Radar">
      </div>
      <div>
        <a href="https://www.star.nesdis.noaa.gov/GOES/conus_band.php?sat=G16&amp;band=GEOCOLOR&amp;length=24"
          target="new"><img id="satellite"
            data-src="https://cdn.star.nesdis.noaa.gov/GOES16/ABI/SECTOR/cgl/GEOCOLOR/GOES16-CGL-GEOCOLOR-600x600.gif"
            class="lazy-load" alt="Satellite">
        </a>
      </div>

    </div>
    <div class="image-grid"></div>
    <script>
      const lazyLoadImages = () => {
        const images = document.querySelectorAll('.lazy-load');
        const options = {
          threshold: 0.2,
          rootMargin: '0px 0px 100px 0px'
        };

        const observer = new IntersectionObserver(entries => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              const src = img.getAttribute('data-src');

              img.setAttribute('src', src);
              img.classList.remove('lazy-load');
              observer.unobserve(img);
            }
          });
        }, options);

        images.forEach(img => observer.observe(img));
      };

      window.addEventListener('DOMContentLoaded', lazyLoadImages);
    </script>


    <div style="clear: both;"></div>
    <div class="image-grid" id="pivotals">
      <!-- <img id="pivotal6hQPF" src="" alt="Weather Image"> -->
      <a target="new" href="https://www.pivotalweather.com/maps.php?ds=ndfd&p=ndfd_6hqpf&r=us_state_oh&pwplus=1">
        <img src="https://x-hv1.pivotalweather.com/maps/ndfd/latest/ndfd_6hqpf.us_state_oh.png">
      </a>
      <a target="new"
        href="https://www.pivotalweather.com/model.php?m=hrrr&p=snowfall_acc-imp&rh=2024011518&fh=1&r=us_state_oh&dpdt=&mc=&pwplus=1">
        <img src="https://x-hv1.pivotalweather.com/maps/ndfd/latest/ndfd_24hsnow.us_state_oh.png">
      </a>
      <a target="new" href="https://www.glerl.noaa.gov/res/glcfs/ice.php?lake=eri" target="_blank">
        <img alt="" src="https://www.glerl.noaa.gov/data/ice/spaghetti/eri_ice_compare.png">
      </a>
      <a target="new" href="https://www.glerl.noaa.gov/res/glcfs/ice.php?lake=eri" target="_blank">
        <img alt="" src="https://www.glerl.noaa.gov/res/glcfs/eri/aice.png">
      </a>
      <img src="https://www.weather.gov/images/cle/winter/StormTotalSnow.jpg">
    
    </div>
    <div class="meteos"></div>

    <!-- <img src="images/clegfs.png" /> -->
    <!-- <img src="http://wxmaps.org/pix/clegfsb.png" />--> <br />
    &nbsp;</p>

    <p><iframe height="4250px" src="meteos.html" width="1200px"></iframe></p>

    <p></p>

    <!-- HIDE UNTIL HURRICANE SEASON
    <p><a href="https://www.nhc.noaa.gov/"><img src="https://www.nhc.noaa.gov/xgtwo/two_atl_0d0.png?061759" /></a></p>
    -->
  <p><br />
    <strong>Dusk Progression</strong><br />
    6:00 January 23<br />
    6:15 February 4<br />
    6:30 February 17<br />
    6:45 March 1<br />
    6:54 March 9<br />
    7:56 March 10<br />
    &nbsp;
  </p> 
  <p id="nextSunnyDay"></p>
<!--
  <p>Waves<br />
  <img src="https://marine.weather.gov/meteograms/Plotter.php?lat=41.513&amp;lon=-81.8124&amp;wfo=CLE&amp;zcode=LEZ146&amp;gset=20&amp;gdiff=6&amp;unit=0&amp;tinfo=EY5&amp;ahour=0&amp;pcmd=00000000000000000101000000000000000000000000000000000000000&amp;lg=en&amp;indu=0!1!1!&amp;dd=&amp;bw=&amp;hrspan=48&amp;pqpfhr=6&amp;psnwhr=6" /> <img src="https://marine.weather.gov/meteograms/Plotter.php?lat=41.513&amp;lon=-81.8124&amp;wfo=CLE&amp;zcode=LEZ146&amp;gset=20&amp;gdiff=6&amp;unit=0&amp;tinfo=EY5&amp;ahour=48&amp;pcmd=00000000000000000101000000000000000000000000000000000000000&amp;lg=en&amp;indu=0!1!1!&amp;dd=&amp;bw=&amp;hrspan=48&amp;pqpfhr=6&amp;psnwhr=6" /> <img src="https://marine.weather.gov/meteograms/Plotter.php?lat=41.513&amp;lon=-81.8124&amp;wfo=CLE&amp;zcode=LEZ146&amp;gset=20&amp;gdiff=6&amp;unit=0&amp;tinfo=EY5&amp;ahour=96&amp;pcmd=00000000000000000101000000000000000000000000000000000000000&amp;lg=en&amp;indu=0!1!1!&amp;dd=&amp;bw=&amp;hrspan=48&amp;pqpfhr=6&amp;psnwhr=6" /><br />
  Airport<br />
  <img src="https://marine.weather.gov/meteograms/Plotter.php?lat=41.410&amp;lon=-81.8545&amp;wfo=CLE&amp;zcode=LEZ146&amp;gset=20&amp;gdiff=6&amp;unit=0&amp;tinfo=EY5&amp;ahour=0&amp;pcmd=00001000000000011000000000000000000000000000000000000000000&amp;lg=en&amp;indu=0!1!1!&amp;dd=&amp;bw=&amp;hrspan=48&amp;pqpfhr=6&amp;psnwhr=6" /> <img src="https://marine.weather.gov/meteograms/Plotter.php?lat=41.410&amp;lon=-81.8545&amp;wfo=CLE&amp;zcode=LEZ146&amp;gset=20&amp;gdiff=6&amp;unit=0&amp;tinfo=EY5&amp;ahour=48&amp;pcmd=00001000000000011000000000000000000000000000000000000000000&amp;lg=en&amp;indu=0!1!1!&amp;dd=&amp;bw=&amp;hrspan=48&amp;pqpfhr=6&amp;psnwhr=6" /> <img src="https://marine.weather.gov/meteograms/Plotter.php?lat=41.410&amp;lon=-81.8545&amp;wfo=CLE&amp;zcode=LEZ146&amp;gset=20&amp;gdiff=6&amp;unit=0&amp;tinfo=EY5&amp;ahour=96&amp;pcmd=00001000000000011000000000000000000000000000000000000000000&amp;lg=en&amp;indu=0!1!1!&amp;dd=&amp;bw=&amp;hrspan=48&amp;pqpfhr=6&amp;psnwhr=6" /></p>
  -->

    <!--
  <p><iframe height="480" src="http://radblast.wunderground.com/cgi-bin/radar/WUNIDS_map?station=CLE&amp;brand=wui&amp;num=20&amp;delay=11&amp;type=NCR&amp;frame=0&amp;scale=0.560&amp;noclutter=0&amp;lat=41.30609894&amp;lon=-81.85630035&amp;label=Strongsville%2C+OH&amp;showstorms=0&amp;map.x=800&amp;map.y=640&amp;centerx=422&amp;centery=180&amp;transx=22&amp;transy=-60&amp;showlabels=1&amp;severe=0&amp;rainsnow=0&amp;lightning=0&amp;smooth=0" style=";margin:0px;z-index:1;&quot;" width="640"></iframe><br />
  <iframe height="480" src="http://radblast.wunderground.com/cgi-bin/radar/WUNIDS_map?station=CLE&amp;brand=wui&amp;num=20&amp;delay=11&amp;type=NCR&amp;frame=0&amp;scale=0.160&amp;noclutter=0&amp;lat=41.30609894&amp;lon=-81.85630035&amp;label=Strongsville%2C+OH&amp;showstorms=0&amp;map.x=800&amp;map.y=640&amp;centerx=422&amp;centery=180&amp;transx=22&amp;transy=-60&amp;showlabels=1&amp;severe=0&amp;rainsnow=0&amp;lightning=0&amp;smooth=0" style=";margin:0px;z-index:3;&quot;" width="640"></iframe>--->
</body>

</html>
================================================================================

File Path: /Users/outjet/Sites/radarb/public/styles/style.css
--------------------------------------------------------------------------------
:root {
    --screen-width: 100vw; /* Initialize the variable with a default value */
  }
  
body {
    font-family: 'Open Sans', sans-serif;
    font-weight: 600;
    font-size: 0.8em;
    background: rgb(46, 46, 56);
    color: white;
    display: flex;
}

a {
    color: white;
}

a:visited {
    color: white;
}

.readmorebutton {
    background-color: SlateGray;
    border: none;
    color: white;
    padding: 6px 8px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 11px;
    margin: 2px 1px;
    cursor: pointer;
}

.holder-of-the-divs {
    width: var(--screen-width);
    max-width: 1000px; /* Set a maximum width of 1000px */
}


/* Media query for smaller screens */
@media (max-width: 999px) { /* Adjust 600px to your needs */
    .alerts-container {
        max-width: 470px!important;
    }
     .holder-of-the-divs {
        width: var(--screen-width);
        max-width: 500px; /* Set a maximum width of 1000px */
    }
    .sensor-container{
    font-size: smaller;
    }
}
.delays-container {
    display: none;
    text-align: center;
    background-color: indianred;
}

.ground-stops {
    padding: 5px;
    display: none;
    text-align: center;
    background-color: indianred;
}

.crosswind-alert {
    background-color: red;
    color: white;
    text-align: center;
    padding: 10px;
}

.weather-alert {
    background-color: #ee6c00;
    color: white;
    text-align: center;
    padding: 10px;
    border-bottom: 1px solid #ffb627;
}

/* CSS styles for the radar grid */
.radar-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: 1fr 1fr;
    grid-gap: 10px;
    overflow: hidden;
}

.radar-grid img {
    object-fit: cover;
    max-width: 460px;
    max-height: 460px;
    object-fit: contain;
}

/* Media query for smaller screens */
@media (max-width: 999px) {
    .radar-grid {
        grid-template-columns: repeat(1, 1fr); /* 1 column */
        max-width: 470px; /* Adjust as needed */
    }
}

.meteos img {
    width:33%;
    transition: width 1.3s ease-in-out;
}

.meteos img:hover{
    width: 100%;
}

.image-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    /* grid-template-rows: 1fr 1fr; */
    grid-gap: 10px;
    max-width: 1057px;
    overflow: hidden;
}


.image-grid div {
    /* width: 480px;
            height: 360px; */
    overflow: hidden;
    margin: 10px;
    align-items: center;
    text-align: center;
    border: 3px solid rgb(85 85 87);
}

.image-grid img {
    object-fit: cover;
    max-width: 460px;
    max-height: 460px;
    object-fit: contain;
}


.image-grid .caption {
    padding: 0;
    margin: 0;
    font-size: 1.5em;
    background-color: rgb(70 74 80 / 80%);
    width: 100%;
    font-weight: 100;
    color: white;
}

/* Media query for smaller screens */
@media (max-width: 999px) { /* Adjust 600px to your needs */
    .image-grid {
        grid-template-columns: repeat(1, 1fr); /* 1 column */
        max-width: 470px!important;
    }
}

.prompt-container {
    display: none;
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 999;
}

.prompt-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
}

.prompt-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
}

/* CSS for the loading message */
.loading {
    text-align: center;
    font-size: 24px;
    margin-top: 50px;
}

#clocks {
    font-size: 1.1em;
    vertical-align: middle;
    text-align: center;
}

.sensor-container {
    display: flex;
    /* use flexbox layout */
    justify-content: space-between;
    margin-bottom: 10px;
    margin-top: 10px;
}

.sensor-box {
    width: 17%;
    padding: 10px;
    box-sizing: border-box;
    background: linear-gradient(to bottom left, #33ad55, #03730c);
    color: white;

}


.sensor-box.IceWatch {
    background-color: red;
    color: white;
    background: repeating-linear-gradient(160deg, #f31515, #e95e5e 100px)
}

.forecast-container {
    display: flex;
    justify-content: space-between; /* Distributes items evenly */
    width: 80%;
    font-family: 'Poppins', 'Roboto', 'Open Sans', 'Segoe UI', 'Arial', sans-serif;
    color: #333; /* Dark color for text */
    margin-bottom: 10px;
    padding: 10px; /* Add some padding if needed */
    background-color: transparent; /* No background color here */
}

.forecast {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; /* Center items vertically */
    width: 18%; /* Adjust width to fit all items */
    background-color: #fff; /* White background for the cards */
    padding: 20px;
    border-radius: 15px; /* Rounded corners for the cards */
    box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Subtle shadow for depth */
    margin: 5px; /* Spacing between cards */
}

.day {
    text-align: center;
    font-size: 1.5em; /* Larger text for the day */
    font-weight: 500; /* Adjust weight as needed */
    margin-bottom: 10px; /* Space between day and icon */
}

.weather-icon {
    width: 60px; /* Larger icon */
    height: 60px; /* Larger icon */
    margin-top: 10px; /* Adjust spacing as needed */
}

.high-low {
    font-size: 2em; /* Larger text for temperature */
    font-weight: 700; /* Bolder text for temperature */
    margin-top: 10px; /* Space between icon and temperature */
}


#weatherDataContainer {
    display: flex;
    /* use flexbox layout */
    width: 1020px;
    justify-content: space-between;
    margin-bottom: 10px;
}

.weather-point {
    width: 17%;
    margin-right: 2%;
    padding: 10px;
    box-sizing: border-box;
    background: linear-gradient(to bottom left, #33ad55, #03730c);
    color: white;

}

#ambientWeatherDataContainer {
    border-radius: 10px;
    display: flex;
    flex-direction: column; /* Display children in a column layout */
    align-items: center;
    background-color: #268ea3;    
    margin-bottom: 10px;
  }
  
/* Media query for smaller screens */
@media (max-width: 999px) { /* Adjust 999px to your needs */
    .forecast-container {
        flex-wrap: nowrap; /* Allows items to wrap to the next line */
        justify-content: center; /* Centers items when they wrap */
        padding: 5px; /* Reduce padding */
        width: 100%;
    }
    .forecast {
        width: 45%; /* Adjust width to have 2 items per row */
        margin: 5px; /* Adjust margins for spacing */
        padding: 15px; /* Reduce padding inside the cards */
    }
    .day, .high-low {
        font-size: 1em; /* Adjust font size down */
    }
    .weather-icon {
        width: 40px; /* Adjust icon size down */
        height: 40px; /* Adjust icon size down */
    }
    /* Your other elements' styles */
    p#windgusts {
        font-size: .9em;
    }
    p#feelslike-temperature {
        font-size: .9em;
    }
    p.wxelement {
        font-size: 12px;
    }

}


  .pws-box {
    display: flex; /* Display left and right boxes in a row */
    justify-content: space-between; /* Space between left and right boxes */
    color: white; /* Text color */
  }
  
  .pws-box-left,
  .pws-box-right {
    flex: 1; /* Equal width for both columns */
    padding: 10px; /* Padding for spacing */
    box-sizing: border-box; /* Include padding in the width calculation */
  }

  .wxelement {
    display: flex;
    align-items: center;
    font-size:20px;
    text-align: center;
  }

  p#feelslike-temperature {
    text-align: center;
}

p#windgusts {
    text-align: center;
}
  
  .wxelement img {
    width: 36px;
    margin-right: 10px; /* Add some space between the icon and text */
  }
  
img#uvimg {
    width: 50px;
}

  .wind.wxelement {
    height: 65px;
}

img#satellite {
    margin-bottom: -100px;
}

.wind-indicator-container {
    width: 45px;
    height: 45px;
    border: 1px solid rgb(255, 255, 255);
    position: relative;
    border-radius: 50%;
    background-color: #507595;
    margin-right: 5px;
}

.wind-arrow {
    width: 3px;
    height: 25px;
    background-color: white;
    position: absolute;
    bottom: 50%;
    left: 50%;
    transform-origin: 50% 100%;
    /* Initial transform rotate, will be updated with JS */
    transform: translateX(-50%) rotate(0deg);
    transition: transform 0.5s ease-in-out;
}

/* Add these styles to your existing CSS */
.weather-refresh {
    position: relative;
    background-color: rgba(0, 0, 0, 0.5); /* Background color for the timer */
    color: white; /* Text color for the timer */
    padding: 5px 10px; /* Adjust padding as needed */
    border-radius: 5px; /* Rounded corners for the timer */
    margin-top: -20px;
    margin-bottom: 10px;
}

.last-refresh {
    font-size: 12px; /* Adjust font size as needed */
}

================================================================================

File Path: /Users/outjet/Sites/radarb/public/scripts/app1597.js
--------------------------------------------------------------------------------
let userLat = 41.48;
let userLng = -81.81;
const AMBIENT_WEATHER_API_URL = 'https://us-central1-radarb.cloudfunctions.net/getAmbientWeatherData';
const PIVOTAL_WEATHER_API_URL = 'https://us-central1-radarb.cloudfunctions.net/getPivotalHRRR6hQPF';
let isFirstRefresh = true;

let sensorDataDisplayed = false;
function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371; // Earth's radius in km
  const dLat = toRadians(lat2 - lat1);
  const dLon = toRadians(lon2 - lon1);
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
    Math.sin(dLon / 2) * Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  const d = R * c;
  return d;
}
function toRadians(degrees) {
  return degrees * Math.PI / 180;
}

window.addEventListener("load", () => {
  const forecastContainer = document.querySelector('.forecast-container');
  forecastContainer.innerHTML = 'Loading forecast... . .';
  console.log('Using fixed geolocation');

  const lat = userLat;
  const lng = userLng;
  const boxsize = 8;
  const latne = lat + boxsize / 69;
  const lngne = lng + boxsize / 53;
  const latsw = lat - boxsize / 69;
  const lngsw = lng - boxsize / 53;

  console.log('Latitude ', lat);
  console.log('Longitude ', lng);

  // Dispatch events to load camera and sensor data
  window.dispatchEvent(new CustomEvent("loadCameraData", {
    detail: { latne, lngne, latsw, lngsw, lat, lng }
  }));

  console.log(`About to call getWeatherForecast with ${lat}, ${lng}`);

  getWeatherForecast(lat, lng);

  window.dispatchEvent(new CustomEvent("loadSensorData", {
    detail: { latne, lngne, latsw, lngsw, lat, lng }
  }));

  // Display meteograms for the current location
  setTimeout(() => {
    const meteosDiv = document.querySelector('.meteos');
    const urlb = '&wfo=CLE&zcode=LEZ146&gset=20&gdiff=6&unit=0&tinfo=EY5&pcmd=10111110111110000000000000000000000000000000000000000000000&lg=en&indu=0!1!1!&dd=&bw=&hrspan=48&pqpfhr=6&psnwhr=6'
    const images = [
      {
        hour: 0,
        src: `https://marine.weather.gov/meteograms/Plotter.php?lat=${lat}&lon=${lng}&ahour=0${urlb}`,
      },
      {
        hour: 48,
        src: `https://marine.weather.gov/meteograms/Plotter.php?lat=${lat}&lon=${lng}&ahour=48${urlb}`,
      },
      {
        hour: 96,
        src: `https://marine.weather.gov/meteograms/Plotter.php?lat=${lat}&lon=${lng}&ahour=96${urlb}`,
      },
    ];

    // Create an <img> element for each meteogram and append it to the .meteos div
    for (const image of images) {
      const img = document.createElement('img');
      img.setAttribute('src', image.src);
      img.setAttribute('alt', `Meteogram for ${image.hour} hours`);
      meteosDiv.appendChild(img);
    }
  }, 3000);
});

// CAMERAS 

window.addEventListener("loadCameraData", (event) => {
  const { latne, lngne, latsw, lngsw, lat, lng } = event.detail;
  fetch(`https://us-central1-radarb.cloudfunctions.net/getCameraData?latne=${latne}&lngne=${lngne}&latsw=${latsw}&lngsw=${lngsw}`)
    .then(response => response.json())
    .then(data => {
      displayCameraData(data, lat, lng);
    })
    .catch(error => {
      console.error(error);
    });
});

const displayCameraData = (data, userLat, userLng) => {
  const cameraDistances = [];

  // Calculate the distance from the user's location to each camera
  data.results.forEach(camera => {
    const distance = haversine(userLat, userLng, camera.latitude, camera.longitude);
    cameraDistances.push({ camera, distance });
  });

  // Sort the cameras by their distance
  cameraDistances.sort((a, b) => a.distance - b.distance);

  // Display the closest four cameras
  const imageGrid = document.querySelector(".image-grid");
  imageGrid.innerHTML = ""; // clear previous cameras
  for (let i = 0; i < Math.min(4, cameraDistances.length); i++) {
    const camera = cameraDistances[i].camera;
    const div = document.createElement("div");
    const img = document.createElement("img");
    img.setAttribute("src", camera.cameraViews[0].smallUrl);
    img.setAttribute("alt", camera.description);
    const caption = document.createElement("div");
    caption.classList.add("caption");
    if (camera.cameraViews[0].mainRoute.includes("Hilliard")) {
      caption.textContent = 'I-90 between Hilliard/Mckinley';
    } else {
      caption.textContent = camera.cameraViews[0].mainRoute;
    }
    div.appendChild(img);
    div.appendChild(caption);
    imageGrid.appendChild(div);
  }
};

window.addEventListener("load", () => {
  let refreshIntervalId = setInterval(() => {
    let images = document.querySelectorAll(".image-grid img");
    images.forEach(img => {
      let currentSrc = img.getAttribute("src");
      img.setAttribute("src", currentSrc + "?t=" + new Date().getTime());
    });
  }, 4250);

});

// SENSORS
const displaySensorData = (data, lat, lng) => {
  // Ensure sensorContainer is defined at the beginning of the function
  const sensorContainer = document.querySelector(".sensor-container");
  if (!sensorContainer) {
    console.error("Sensor container not found");
    return;
  }

  const sensorDistances = [];

  // Calculate the distance from the user's location to each sensor
  console.log(`Calculate the distance from the user's location to each sensor`);
  data.results.forEach(result => {
    result.surfaceSensors.forEach(sensor => {
      if (sensor.surfaceTemperature === -9999999.0) return;
      const distance = haversine(lat, lng, sensor.latitude, sensor.longitude);
      sensorDistances.push({ sensor, distance });
    });
  });

  // Sort the sensors by their distance
  sensorDistances.sort((a, b) => a.distance - b.distance);

  // Display the closest three sensors
  console.log(`Display the closest three sensors`);
  for (let i = 0; i < Math.min(3, sensorDistances.length); i++) {
    const sensor = sensorDistances[i].sensor;
    const div = document.createElement("div");
    div.classList.add("sensor-box");
    if (sensor.status === "Ice Watch") {
      div.classList.add("IceWatch");
    }

    let sensorDetails = "";
    div.innerHTML = sensor.name.substring(0, sensor.name.length - 4);
    if (sensor.description) {
      sensorDetails += "<br>" + "Description: " + sensor.description;
    }
    if (sensor.condition) {
      sensorDetails += "<br>" + "Condition: " + sensor.condition;
    }
    console.log(`Add sensor details to the DOM`);
    div.innerHTML += sensorDetails;
    div.innerHTML += "<br>" + "Surface temp: " + sensor.surfaceTemperature;
    div.innerHTML += "<br>" + "Status: " + sensor.status;
    sensorContainer.appendChild(div);
  }


  // Check if sensor data is empty
  console.log(`Check if sensor data is empty`);
  if (data.results.length === 0) {
    const sensorContainer = document.querySelector(".sensor-container");
    const div = document.createElement("div");
    div.classList.add("sensor-box");
    div.innerHTML = "No sensor data returned from ODOT";
    sensorContainer.appendChild(div);
  }

  const forecastDiv = document.createElement("div");
  forecastDiv.classList.add("sensor-box");
  forecastDiv.style.backgroundColor = "#DDD";
  forecastDiv.innerHTML = "<a href='https://forecast.weather.gov/product.php?site=CLE&issuedby=CLE&product=AFD&format=CI&version=1&glossary=1&highlight=off' target='_blank'>Forecast discussion</a><br><a href='https://icyroadsafety.com/lcr/' target='_blank'>Icy Road Forecast</a><br><a href='http://wxmaps.org/pix/clegfs.png' target='_blank'>GFS </A> <a href='http://wxmaps.org/pix/clegfsb.png' target='_blank'>GFSLR </a> <a href='http://wxmaps.org/pix/clenam.png' target='_blank'>NAM</a>";
  sensorContainer.appendChild(forecastDiv);

  const clocksDiv = document.createElement("div");
  clocksDiv.classList.add("sensor-box");
  clocksDiv.id = "clocks";
  clocksDiv.style.backgroundColor = "#DDD";
  clocksDiv.style.color = "#white";
  clocksDiv.innerHTML = "<div><span id='local-time'></span> ET</div><div><div><span id='refresh-paused' style='display:none;'>REFRESH PAUSED</span></div>";
  sensorContainer.appendChild(clocksDiv);

  document.getElementById("clocks").addEventListener("click", function () {
    let clocks = document.getElementById("clocks");
    clocks.style.backgroundColor = "#DDD";
    clocks.style.color = "white";
    document.getElementById("refresh-paused").style.display = "none";
    refreshIntervalId = setInterval(() => {
      let images = document.querySelectorAll(".image-grid img");
      images.forEach(img => {
        let currentSrc = img.getAttribute("src");
        img.setAttribute("src", currentSrc + "?t=" + new Date().getTime());
      });
    }, 4250);
  });
};


window.addEventListener("loadSensorData", (event) => {
  const { latne, lngne, latsw, lngsw, lat, lng } = event.detail;
  console.log(`starting loadSensorData`);
  if (sensorDataDisplayed) {
    return;
  }
  console.log(`fetching getSensorData function`);
  fetch(`https://us-central1-radarb.cloudfunctions.net/getSensorData?latne=${latne}&lngne=${lngne}&latsw=${latsw}&lngsw=${lngsw}`)
    // fetch(`http://127.0.0.1:5005/radarb/us-central1/getSensorData?latne=${latne}&lngne=${lngne}&latsw=${latsw}&lngsw=${lngsw}`)
    .then(response => response.json())
    .then(data => {
      sensorDataDisplayed = true;
      console.log(`displaying SensorData`);
      displaySensorData(data, lat, lng);
      console.log(`updateTime starting`);
      updateTime(lat, lng);
      // setInterval(() => {
      //   updateTime(lat, lng);
      // }, 1000);
    })
    .catch(error => {
      console.error(error);
    });
});

let cityName = "";

window.addEventListener("load", () => {
  console.log(`dispatching updateTime`);
  window.dispatchEvent(new Event("updateTime"));
});

async function updateTime(lat, lng) {
  const localTime = new Date().toLocaleString("en-US", {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: true
  });

  document.getElementById("local-time").innerHTML = localTime;


  setInterval(() => {
    const localTime = new Date().toLocaleString("en-US", {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: true
    });

    document.getElementById("local-time").innerHTML = localTime;
  }, 1000);

  const youAreHereSpan = document.getElementById("you-are-here");
  if (cityName) {
  } else {
    // Fetch the city name from the coordinates
    const cache = await caches.open("my-cache");
    const url = 'https://us-central1-radarb.cloudfunctions.net/getCityName?lat=' + lat + '&lng=' + lng;
    // const url = 'http://127.0.0.1:5005/radarb/us-central1/getCityName?lat=' + lat + '&lng=' + lng;    
    console.log(`about to await getCityName`);
    const response = await cache.match(url) || await fetch(url);
    const data = await response.json();
    console.log(`got the cityName`);
    // const addressComponents = data.results[0].address_components;
    // const formattedAddress = data.address;
    // const premiseType = data.premiseType;
    // youAreHereSpan.innerHTML += `Found you at: <A Href="https://ohgo.com/cleveland?lt=${lat}&ln=${lng}&z=13&ls=incident,incident-waze,dangerous-slowdown,camera,delay,weather,weather-roadsensors,sign" target="_blank">${formattedAddress}</A> - ${premiseType}<br><br>`;
  }
}

async function getWeatherForecast(lat, lng) {
  const forecastContainer = document.querySelector('.forecast-container');
  try {
    let data;
    const cachedData = localStorage.getItem('weatherData');
    if (cachedData) {
      const cachedDataTime = localStorage.getItem('weatherDataTime');
      const currentTime = Date.now();
      if ((currentTime - cachedDataTime) / 1000 / 60 < 1) {
        data = JSON.parse(cachedData);
        console.log(`using cached onecall`);
      } else {
        localStorage.removeItem('weatherData');
        localStorage.removeItem('weatherDataTime');
      }
    }
    if (!data) {
      console.log(`fetching live onecall getWeatherData with lat: ${lat} and lng: ${lng}`);
      const response = await fetch(`https://us-central1-radarb.cloudfunctions.net/getWeatherData?lat=${lat}&lng=${lng}`);
      data = await response.json();
      localStorage.setItem('weatherData', JSON.stringify(data));
      localStorage.setItem('weatherDataTime', Date.now());
    }
    const fiveDays = data.daily.slice(0, 5);
    const hourlyForecast = data.hourly;
    const runway_deg = 58.1; //KCLE Runway 06L/24R
    const opposite_runway_deg = (runway_deg + 180) % 360;
    const crosswindThreshold = 20; // mph
    let crosswindAlert = null;
    let crosswindSpeed = 0;
    let maxcrosswindSpeed = 0;
    let maxCrosswindTime = null;
    for (const hour of hourlyForecast) {
      const { dt, wind_speed, wind_deg } = hour;
      let crosswind;
      if (Math.abs(wind_deg - runway_deg) <= Math.abs(wind_deg - opposite_runway_deg)) {
        crosswind = wind_speed * Math.sin((wind_deg - runway_deg) * Math.PI / 180);
      } else {
        crosswind = wind_speed * Math.sin((wind_deg - opposite_runway_deg) * Math.PI / 180);
      }
      if (Math.abs(crosswind) >= crosswindThreshold) {
        crosswindAlert = dt;
        crosswindSpeed = crosswind;
        if (Math.abs(crosswind) > maxcrosswindSpeed) {
          maxcrosswindSpeed = Math.abs(crosswind);
          maxCrosswindTime = new Date(dt * 1000);
        }
        break;
      } else if (Math.abs(crosswind) > maxcrosswindSpeed) {
        maxcrosswindSpeed = Math.abs(crosswind);
        maxCrosswindTime = new Date(dt * 1000);
      }
    }

    const crosswindContainer = document.querySelector('.crosswind-container');
    crosswindContainer.innerHTML += '';
    console.log('Checking for 06L/24R crosswinds');

    if (crosswindAlert) {
      const alertDiv = document.createElement("div");
      alertDiv.classList.add("crosswind-alert");
      alertDiv.innerHTML = `CLE Runway Crosswind Alert starting ${new Date(crosswindAlert * 1000).toLocaleString()}`;

      // Find the hour with maximum crosswind
      const maxCrosswindHour = hourlyForecast.reduce((maxHour, hour) => {
        const { wind_speed, wind_deg } = hour;
        let crosswind;
        if (Math.abs(wind_deg - runway_deg) <= Math.abs(wind_deg - opposite_runway_deg)) {
          crosswind = wind_speed * Math.sin((wind_deg - runway_deg) * Math.PI / 180);
        } else {
          crosswind = wind_speed * Math.sin((wind_deg - opposite_runway_deg) * Math.PI / 180);
        }
        if (Math.abs(crosswind) > Math.abs(maxHour.crosswind)) {
          return {
            crosswind: crosswind,
            wind_speed: wind_speed,
            wind_deg: wind_deg,
            dt: hour.dt
          };
        } else {
          return maxHour;
        }
      }, { crosswind: 0, wind_speed: 0, wind_deg: 0, dt: 0 });

      // Format the output for the maximum crosswind
      const maxCrosswindDate = new Date(maxCrosswindHour.dt * 1000).toLocaleString();
      console.log('about to spit out the max crosswinds')
      const maxCrosswindOutput = `<BR>Max crosswind ${Math.abs(maxCrosswindHour.crosswind.toFixed(0))} MPH (${Math.abs(maxCrosswindHour.wind_speed.toFixed(0))} @ ${Math.abs(maxCrosswindHour.wind_deg.toFixed(0))}°) ${maxCrosswindDate}`;
      alertDiv.innerHTML += maxCrosswindOutput;
      crosswindContainer.appendChild(alertDiv);
    }


    setTimeout(() => {
      if (data.alerts) {
        data.alerts.forEach(alert => {
          if (alert.event.includes("Small Craft Advisory")) {
            return;
          }

          const alertDiv = document.createElement("div");
          alertDiv.classList.add("weather-alert");

        // Find the index of the first hyphen
        const firstHyphenIndex = alert.description.indexOf('-');

        // Get the substring before the first hyphen (up to 82 characters)
        const truncatedDescription = alert.description.substring(0, firstHyphenIndex > -1 ? firstHyphenIndex : 82);

          // Create a span to hold the truncated description and a button to expand it
          const descriptionSpan = document.createElement("span");
          descriptionSpan.textContent = truncatedDescription;

          const readMoreButton = document.createElement("button");
          readMoreButton.textContent = "read more...";
          readMoreButton.classList.add("readmorebutton"); // Add the readmorebutton class

          readMoreButton.addEventListener("click", () => {
            descriptionSpan.textContent = alert.description;
            readMoreButton.style.display = "none";
          });


          // Add the truncated description and the "read more..." button to the alertDiv
          alertDiv.innerHTML = `${alert.event} - `;
          alertDiv.appendChild(descriptionSpan);
          alertDiv.appendChild(readMoreButton);

          crosswindContainer.appendChild(alertDiv)
        });
      }
    }, 20); //delay loading weather alert section for 10 seconds. 


    const forecastContainer = document.querySelector('.forecast-container');
    forecastContainer.innerHTML = ''; // Clear loading message
    fiveDays.forEach(day => {
      const { dt, temp, weather } = day;
      const dayName = new Date(dt * 1000).toLocaleString('default', { weekday: 'short' });
      const high = temp.max.toFixed(0);
      const low = temp.min.toFixed(0);
      const iconCode = weather[0].icon;
      const iconUrl = `images/${iconCode}.png`;

      const forecastDiv = document.createElement("div");
      forecastDiv.classList.add("forecast");
      forecastDiv.innerHTML = `
    <div class="day">${dayName}</div>
    <div class="weather-icon-div"><img src="${iconUrl}" class="weather-icon"></div>
    <div class="high-low">${high}/${low}</div>
  `;
      forecastContainer.appendChild(forecastDiv);
    });
  } catch (error) {
    forecastContainer.innerHTML = 'Error loading forecast.';
    console.error(error);
  }
}

window.addEventListener("load", () => {
  // Select container for ground stops
  const groundStopsContainer = document.querySelector('.ground-stops');

  // Select the delays container
  const airportDelays = document.querySelector(".airportDelays");
  const delaysContainer = document.querySelector('.delays-container');

  console.log('Checking for ground stops');
  console.log('Just kidding, I have commented this code out');

  // fetch("https://us-central1-radarb.cloudfunctions.net/getGroundStopInfo")
  // fetch("http://127.0.0.1:5005/radarb/us-central1/getGroundStopInfo")
  // .then((response) => response.text())
  // .then((data) => {
  //   if (data.length > 0) {
  //     // Append the ground stop data to the new container
  //     groundStopsContainer.textContent = data;
  //     groundStopsContainer.style.display = 'block';
  //   }
  // })
  // .catch((error) => console.error(error))
  // ;

  console.log('Checking for KCLE delays');
  let airportCode = 'KCLE';
  // fetch(`http://127.0.0.1:5005/radarb/us-central1/getFlightDelays?airportCode=${airportCode}`)
  fetch(`https://us-central1-radarb.cloudfunctions.net/getFlightDelays?airportCode=${airportCode}`)
    .then(response => response.text())
    .then(data => {
      if (data.length > 0) {
        // Append the flight delay data to the existing container
        airportDelays.textContent += `✈ ` + data;
        delaysContainer.style.display = 'block';
      }
    })
    .catch(error => console.error(error))
});


// Function to fetch weather data from your weather station
async function fetchWeatherDataFromStation() {
  try {
    const response = await fetch(AMBIENT_WEATHER_API_URL);
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    const weatherData = await response.json();
    return weatherData[0].lastData;
  } catch (error) {
    console.error('Error fetching weather data from station:', error);
    throw error;
  }
}

// Function to update all weather fields on the webpage
async function updateCurrentWeather() {
  try {

    // Update the elements with the fetched data



    const currentTemperatureElement = document.querySelector("#current-temperature");
    const currentFeelsLikeElement = document.querySelector("#feelslike-temperature");
    const uvElement = document.querySelector("#uv");
    const currentTimeElement = document.querySelector("#current-time");
    const windGustsElement = document.querySelector("#windgusts");
    const weatherTypeElement = document.querySelector("#weather-type");
    const humidityElement = document.querySelector("#humidity");
    const windElement = document.querySelector("#wind");
    const weatherDataFromStation = await fetchWeatherDataFromStation();
    const windArrow = document.getElementById('windArrow');
    if (windArrow) {
      windArrow.style.transform = `translateX(-50%) rotate(${weatherDataFromStation.winddir}deg)`;
    }
    currentTemperatureElement.innerHTML = `${weatherDataFromStation.tempf.toFixed(1)}°`;
    currentFeelsLikeElement.innerHTML = `Feels like ${weatherDataFromStation.feelsLike.toFixed(1)}°`;
    humidityElement.innerHTML = `${weatherDataFromStation.humidity}%`;
    windElement.innerHTML = `${Math.round(weatherDataFromStation.windspeedmph)} mph`;
    windGustsElement.innerHTML = `Gusts to ${Math.round(weatherDataFromStation.windgustmph)} mph`;
    uvElement.innerHTML = `${Math.round(weatherDataFromStation.uv)}`;
    // Update the last refresh timestamp
    lastRefreshTimestamp = new Date().getTime();
    // Update the countdown timer immediately after refreshing
    updateRefreshTimer();
  } catch (error) {
    console.error('Error updating current weather:', error);
  }
}

document.querySelectorAll('div.last-refresh').forEach(function (div) {
  div.addEventListener('click', function () {
    updateCurrentWeather();
  });
});

// Call the updateCurrentWeather function to update all weather fields
updateCurrentWeather();
// Add this function to format seconds as "mm:ss"
function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = seconds % 60;
  return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
}

// Add a variable to store the last refresh timestamp
let lastRefreshTimestamp = 0;

// Function to update the countdown timer
function updateRefreshTimer() {
  const currentTime = new Date().getTime();
  const elapsedSeconds = Math.floor((currentTime - lastRefreshTimestamp) / 1000);
  const timerElement = document.querySelector("#refresh-timer");
  const timerContainer = document.querySelector(".weather-refresh");

  if (timerElement) {
    if (isFirstRefresh) {
      isFirstRefresh = false;
      timerContainer.style.display = "block"; // Display the timer container on the first refresh
    }

    timerElement.textContent = formatTime(elapsedSeconds);
  }
}
// Call the updateRefreshTimer function initially to set the timer to 0:00
updateRefreshTimer();
// Add an interval to update the countdown timer every second
setInterval(updateRefreshTimer, 1000);

// JavaScript function to create an animation with dynamically generated image URLs
function animateDynamicImages() {
  const baseUrl = 'https://x-hv1.pivotalweather.com/maps/rtma_ru/latest/series_';
  const imageExtension = '.png';
  const numImages = 36; // Number of images to load
  const animationContainer = document.getElementById('animationContainer'); // Select the animation container
  let currentIndex = 0; // Initialize the current image index

  // Function to update the animation container with the next dynamically generated image URL
  function updateAnimationContainer() {
    const imageUrl = `${baseUrl}${currentIndex.toString().padStart(3, '0')}/sfct-imp.us_state_oh${imageExtension}`;
    animationContainer.style.backgroundImage = `url(${imageUrl})`;

    currentIndex = (currentIndex + 1) % numImages; // Loop forward to the next image
  }
  // Set an interval to change the animation at a specific time interval (e.g., every 1 second)
  setInterval(updateAnimationContainer, 1000); // Change animation every 1 second (adjust the interval as needed)
}

// Call the animateDynamicImages function to start the animation with dynamically generated URLs
// Currently Suspended because it takes a lot of data or at least a lot of time. 
// animateDynamicImages();

================================================================================

File Path: /Users/outjet/Sites/radarb/config.js
--------------------------------------------------------------------------------
module.exports = {
    googleMapsApiKey: process.env.GOOGLE_MAPS_API_KEY,
  };
================================================================================

File Path: /Users/outjet/Sites/radarb/firebase.json
--------------------------------------------------------------------------------
{
  "functions": [
    {
      "source": "functions",
      "codebase": "default",
      "ignore": [
        "node_modules",
        ".git",
        "firebase-debug.log",
        "firebase-debug.*.log"
      ]
    }
  ],
  "hosting": {
    "public": "public",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ]
  },
  "emulators": {
    "functions": {
      "port": 5005
    },
    "database": {
      "port": 4242
    },
    "hosting": {
      "port": 5400
    },
    "ui": {
      "enabled": true
    },
    "singleProjectMode": true
  }
}

================================================================================

