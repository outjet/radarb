File Path: /Users/outjet/Sites/radarb/functions/index.js
--------------------------------------------------------------------------------
const functions = require('firebase-functions');
const admin = require('firebase-admin');
const { SecretManagerServiceClient } = require('@google-cloud/secret-manager');
const axios = require('axios');
const cors = require('cors')({ origin: true });

admin.initializeApp();
const client = new SecretManagerServiceClient();

// In-memory caches (Note: Not suitable for serverless scaling)
let cachedOhgoApiKey = null;
let cachedAeroApiKey = null;
let cachedGoogleMapsApiKey = null;
let cachedOpenWeatherMapApiKey = null;

// Helper to access secrets with caching
async function getSecret(secretName, cacheVar) {
  if (cacheVar.value) {
    return cacheVar.value;
  }
  const [version] = await client.accessSecretVersion({ name: secretName });
  cacheVar.value = version.payload.data.toString();
  return cacheVar.value;
}

exports.getCameraData = functions.https.onRequest(async (req, res) => {
  try {
    const ohgoApiKey = await getSecret('projects/358874041676/secrets/ohgo-api/versions/latest', { value: cachedOhgoApiKey });
    const { latsw, lngsw, latne, lngne } = req.query;
    const API_URL = `https://publicapi.ohgo.com/api/v1/cameras?map-bounds-sw=${latsw},${lngsw}&map-bounds-ne=${latne},${lngne}`;

    const response = await axios.get(API_URL, {
      headers: { "Authorization": `APIKEY ${ohgoApiKey}` }
    });

    cors(req, res, () => {
      res.set("Access-Control-Allow-Origin", "*");
      res.set("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS");
      res.json(response.data);
      console.log(`ohGoAPI is: ${ohgoApiKey} and response is`, response.data);
    });
  } catch (error) {
    console.error('Error in getCameraData:', error);
    res.status(500).json({ error: "Error retrieving data" });
  }
});

exports.getSensorData = functions.https.onRequest(async (req, res) => {
  try {
    const ohgoApiKey = await getSecret('projects/358874041676/secrets/ohgo-api/versions/latest', { value: cachedOhgoApiKey });
    const { latsw, lngsw, latne, lngne } = req.query;
    const API_URL = `https://publicapi.ohgo.com/api/v1/weather-sensor-sites?map-bounds-sw=${latsw},${lngsw}&map-bounds-ne=${latne},${lngne}`;

    const response = await axios.get(API_URL, {
      headers: { "Authorization": `APIKEY ${ohgoApiKey}` }
    });

    cors(req, res, () => {
      res.set("Access-Control-Allow-Origin", "*");
      res.json(response.data);
    });
  } catch (error) {
    console.error('Error in getSensorData:', error);
    res.status(500).json({ error: "Error retrieving data" });
  }
});

exports.getFlightDelays = functions.https.onRequest(async (req, res) => {
  try {
    const aeroApiKey = await getSecret('projects/358874041676/secrets/aeroapi/versions/latest', { value: cachedAeroApiKey });
    cors(req, res, async () => {
      const { airportCode } = req.query;
      const apiUrl = `https://aeroapi.flightaware.com/aeroapi/airports/delays?airport_code=${airportCode}`;
      const headers = { 'x-apikey': aeroApiKey };

      const response = await axios.get(apiUrl, { headers });
      const data = response.data;

      if (data && data.delays) {
        const delays = data.delays.filter(delay => delay.airport === airportCode);
        const delayReasons = delays.map(delay => delay.reasons.map(reason => reason.reason)).flat();
        res.status(200).send(delayReasons.join(" | "));
      } else {
        res.status(200).send("");
      }
    });
  } catch (error) {
    console.error('Error in getFlightDelays:', error);
    res.status(500).send("Error retrieving flight delays.");
  }
});

exports.getGroundStopInfo = functions.https.onRequest(async (req, res) => {
  try {
    cors(req, res, async () => {
      res.set("Access-Control-Allow-Origin", "*");
      if (req.method === "OPTIONS") {
        res.set("Access-Control-Allow-Methods", "GET");
        res.set("Access-Control-Allow-Headers", "Content-Type");
        res.status(204).send("");
      } else {
        const apiUrl = "https://soa.smext.faa.gov/asws/api/airport/status/cle";
        process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
        const response = await axios.get(apiUrl);
        const data = response.data;

        if (!data.Delay && data.Status[0].Reason === "No known delays for this airport") {
          res.status(200).send("");
        } else {
          res.status(200).send(data.Status);
        }
      }
    });
  } catch (error) {
    console.error("Error in getGroundStopInfo:", error);
    res.status(500).send("Error fetching ground stop information");
  }
});

exports.getCityName = functions.https.onRequest(async (req, res) => {
  try {
    const googleMapsApiKey = await getSecret('projects/358874041676/secrets/google-maps-api/versions/latest', { value: cachedGoogleMapsApiKey });
    cors(req, res, async () => {
      const { lat, lng } = req.query;
      const url = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lng}&key=${googleMapsApiKey}`;

      const response = await axios.get(url);
      const data = response.data;

      if (data.results.length === 0) {
        res.status(404).json({ error: "No address found" });
        return;
      }

      const addressComponents = data.results[0].address_components;
      const formattedAddress = data.results[0].formatted_address;
      const premiseType = data.results[0].types[0];

      res.set('Access-Control-Allow-Origin', '*');
      res.json({
        address: formattedAddress,
        premiseType: premiseType,
        address_components: addressComponents,
      });
    });
  } catch (error) {
    console.error('Error in getCityName:', error);
    res.status(500).send('Error retrieving city name.');
  }
});

exports.getWeatherData = functions.https.onRequest(async (req, res) => {
  try {
    const openWeatherMapApiKey = await getSecret('projects/358874041676/secrets/openweathermap/versions/latest', { value: cachedOpenWeatherMapApiKey });
    cors(req, res, async () => {
      const { lat, lng } = req.query;
      const url = `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lng}&exclude=minutely&units=imperial&appid=${openWeatherMapApiKey}`;

      const response = await axios.get(url);
      const data = response.data;

      res.json(data);
    });
  } catch (error) {
    console.error('Error in getWeatherData:', error);
    res.status(500).send('Error fetching weather data.');
  }
});

exports.getAmbientWeatherData = functions.https.onRequest(async (req, res) => {
  try {
    // It's better to store applicationKey and apiKey in Secret Manager as well
    const applicationKey = '0acb5017ad334b908f7cf4c021d54ce4ef5d9cf6343b41a7bbdf82d1f3c5ed53';
    const apiKey = '965ff6ce58d444609421f58e0198de214d2985bef33844abaa2d89cd404cfb0c';

    const API_URL = `https://api.ambientweather.net/v1/devices?applicationKey=${applicationKey}&apiKey=${apiKey}`;

    const response = await axios.get(API_URL);

    cors(req, res, () => {
      res.set("Access-Control-Allow-Origin", "*");
      res.json(response.data);
    });
  } catch (error) {
    console.error("Error in getAmbientWeatherData:", error);
    res.status(500).json({ error: "Error retrieving Ambient Weather data" });
  }
});

const cheerio = require('cheerio');

exports.grabPivotalHRRR6hQPF = functions.https.onRequest(async (req, res) => {
  try {
    const pageUrl = 'https://www.pivotalweather.com/model.php?m=hrrr&p=qpf_006h-imp&fh=0&r=us_ma&dpdt=&mc=';
    const pageResponse = await axios.get(pageUrl);
    const $ = cheerio.load(pageResponse.data);
    const hrrr6hQPFimageUrl = $('#display_image').attr('src');

    res.json({ imageUrl: hrrr6hQPFimageUrl });
  } catch (error) {
    console.error('Error in grabPivotalHRRR6hQPF:', error);
    res.status(500).send('Error fetching image URL');
  }
});

================================================================================

File Path: /Users/outjet/Sites/radarb/package.json
--------------------------------------------------------------------------------
{
  "dependencies": {
    "@google-cloud/secret-manager": "^4.2.1",
    "axios": "^1.4.0",
    "cheerio": "^1.0.0-rc.12",
    "cors": "^2.8.5",
    "express": "^4.18.2",
    "firebase-admin": "^11.0.0",
    "firebase-functions": "^4.2.1"
  }
}

================================================================================

File Path: /Users/outjet/Sites/radarb/public/index.html
--------------------------------------------------------------------------------
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RadarB</title>
  
  <!-- Inline critical CSS -->
  <style>
    body {
      font-family: 'Roboto', 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 0.8em;
      background: rgb(46, 46, 56);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 0;
    }
    /* Add other critical styles here */
    .loading {
      text-align: center;
      font-size: 24px;
      margin-top: 50px;
    }
    /* ... */
  </style>

  <!-- Load non-critical CSS asynchronously -->
  <link rel="preload" href="styles/style.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="styles/style.css"></noscript>

  <!-- Google Tag Manager -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-KLC200B4V5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-KLC200B4V5');
  </script>

  <!-- Page Refresh Script -->
  <script>
    // Refresh the page every 6 minutes if visible
    setInterval(() => {
      if (!document.hidden) {
        window.location.reload();
      }
    }, 360000);
  </script>
</head>

<body>
  <div class="holder-of-the-divs">
    <!-- Ambient Weather Data -->
    <div id="ambientWeatherDataContainer">
      <div class="pws-box">
        <div class="pws-box-left">
          <div class="current-temperature wxelement">
            <img src="images/temp.png" alt="Temperature Icon" width="36">
            <p id="current-temperature">--°</p>
          </div>
          <p id="feelslike-temperature">Feels like --°</p>
          <p id="current-day">Loading day...</p>
          <p id="current-time">--:-- --</p>
        </div>
        <div class="pws-box-right">
          <div class="humidity wxelement">
            <img src="images/humidity.png" alt="Humidity Icon" width="36">
            <p id="humidity">--%</p>
          </div>
        </div>
        <div class="pws-box-right">
          <div class="wind wxelement">
            <div class="wind-indicator-container">
              <div class="wind-arrow" id="windArrow"></div>
            </div>
            <p id="wind">-- mph</p>
          </div>
          <p id="windgusts">Gusts to -- mph</p>
        </div>
        <div class="pws-box-right">
          <div class="uv wxelement">
            <img id="uvimg" src="images/uv.png" alt="UV Icon" width="50">
            <p id="uv">--</p>
          </div>
        </div>
      </div>
      <div class="weather-refresh">
        Last Refresh: <span id="refresh-timer">0:00</span>
      </div>
      <div class="forecast-container">
        <!-- Forecast will load here -->
      </div>
    </div>

    <!-- You Are Here -->
    <div class="you-are-here" id="you-are-here">
      <!-- Location info will load here -->
    </div>

    <!-- Alerts -->
    <div class='alerts-container'>
      <div class="delays-container"><span class="airportDelays"></span></div>
      <div class="ground-stops"></div>
      <div class="crosswind-container"><span class="crosswindAlert"></span></div>
    </div>

    <!-- Sensors -->
    <div class='sensor-container'>
      <!-- Sensor data will load here -->
    </div>

    <!-- Radar Grid -->
    <div class="radar-grid">
      <div>
        <img src="https://cdn.tegna-media.com/wkyc/weather/myownradar/comp/880x495/cleveland15.gif"
          alt="Cleveland Radar">
      </div>
      <div>
        <a href="https://fox8.com/weather/forecast/" target="_blank">
          <img src="https://media.psg.nexstardigital.net/WJW/weather/west.jpg" alt="WJW Radar" loading="lazy">
        </a>
      </div>
      <div>
        <img src="https://sirocco.accuweather.com/nx_mosaic_640x480_public/sir/inmsiroh_.gif" alt="Accuweather Radar" loading="lazy">
      </div>
      <div>
        <a href="https://www.star.nesdis.noaa.gov/GOES/conus_band.php?sat=G16&band=GEOCOLOR&length=24"
          target="_blank">
          <img id="satellite"
            data-src="https://cdn.star.nesdis.noaa.gov/GOES16/ABI/SECTOR/cgl/GEOCOLOR/GOES16-CGL-GEOCOLOR-600x600.gif"
            class="lazy-load" alt="Satellite">
        </a>
      </div>
    </div>

    <!-- Image Grid -->
    <div class="image-grid">
      <!-- Camera images will load here -->
      <a href="https://www.pivotalweather.com/maps.php?ds=ndfd&p=ndfd_6hqpf&r=us_state_oh&pwplus=1" target="_blank">
        <img src="https://x-hv1.pivotalweather.com/maps/ndfd/latest/ndfd_6hqpf.us_state_oh.png" alt="Pivotal Weather Map 6h QPF" loading="lazy">
      </a>
      <a href="https://www.pivotalweather.com/model.php?m=hrrr&p=snowfall_acc-imp&rh=2024011518&fh=1&r=us_state_oh&dpdt=&mc=&pwplus=1" target="_blank">
        <img src="https://x-hv1.pivotalweather.com/maps/ndfd/latest/ndfd_24hsnow.us_state_oh.png" alt="Pivotal Weather Snowfall" loading="lazy">
      </a>
      <a href="https://www.glerl.noaa.gov/res/glcfs/ice.php?lake=eri" target="_blank">
        <img src="https://www.glerl.noaa.gov/data/ice/spaghetti/eri_ice_compare.png" alt="GLERL Ice Compare" loading="lazy">
      </a>
      <a href="https://www.glerl.noaa.gov/res/glcfs/ice.php?lake=eri" target="_blank">
        <img src="https://www.glerl.noaa.gov/res/glcfs/eri/aice.png" alt="GLERL AICE" loading="lazy">
      </a>
      <img src="https://www.weather.gov/images/cle/winter/StormTotalSnow.jpg" alt="Storm Total Snow" loading="lazy">
    </div>

    <div class="image-grid" id="pivotals">
      <!-- <img id="pivotal6hQPF" src="" alt="Weather Image"> -->
      <a target="new" href="https://www.pivotalweather.com/maps.php?ds=ndfd&p=ndfd_6hqpf&r=us_state_oh&pwplus=1">
        <img src="https://x-hv1.pivotalweather.com/maps/ndfd/latest/ndfd_6hqpf.us_state_oh.png">
      </a>
      <a target="new"
        href="https://www.pivotalweather.com/model.php?m=hrrr&p=snowfall_acc-imp&rh=2024011518&fh=1&r=us_state_oh&dpdt=&mc=&pwplus=1">
        <img src="https://x-hv1.pivotalweather.com/maps/ndfd/latest/ndfd_24hsnow.us_state_oh.png">
      </a>
      <a target="new" href="https://www.glerl.noaa.gov/res/glcfs/ice.php?lake=eri" target="_blank">
        <img alt="" src="https://www.glerl.noaa.gov/data/ice/spaghetti/eri_ice_compare.png">
      </a>
      <a target="new" href="https://www.glerl.noaa.gov/res/glcfs/ice.php?lake=eri" target="_blank">
        <img alt="" src="https://www.glerl.noaa.gov/res/glcfs/eri/aice.png">
      </a>
      <img src="https://www.weather.gov/images/cle/winter/StormTotalSnow.jpg">
    
    </div>
    <!-- Meteos -->
    <div class="meteos">
      <!-- Meteograms will load here -->
    </div>

    <!-- Iframe for Meteos -->
    <iframe height="4250px" src="meteos.html" width="1200px" loading="lazy"></iframe>

    <!-- Dusk Progression -->
    <p><strong>Dusk Progression</strong><br>
      5:27 December 4 - low point<BR>
      5:32 December 21<BR>
      6:00 January 23<br>
      6:15 February 4<br>
      6:30 February 17<br>
      6:45 March 1<br>
      6:54 March 9<br>
      7:56 March 10<br>
      &nbsp;
    </p>
    <p id="nextSunnyDay"></p>
  </div>

  <!-- Lazy Load Script -->
  <script>
    const lazyLoadImages = () => {
      const images = document.querySelectorAll('.lazy-load');
      const options = {
        threshold: 0.2,
        rootMargin: '0px 0px 100px 0px'
      };

      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            const src = img.getAttribute('data-src');

            img.setAttribute('src', src);
            img.classList.remove('lazy-load');
            observer.unobserve(img);
          }
        });
      }, options);

      images.forEach(img => observer.observe(img));
    };

    window.addEventListener('DOMContentLoaded', lazyLoadImages);
  </script>

  <!-- Main Application Script -->
  <script src="scripts/app1597.js?v=2" defer></script>
</body>

</html>

================================================================================

File Path: /Users/outjet/Sites/radarb/public/styles/style.css
--------------------------------------------------------------------------------
:root {
    --screen-width: 100vw;
    --primary-color: #268ea3;
    --secondary-color: #33ad55;
    --accent-color: #ee6c00;
    --background-color: rgb(46, 46, 56);
    --text-color: white;
    --alert-color: indianred;
    --crosswind-alert-color: red;
    --weather-alert-color: #ee6c00;
    --hover-scale: 1.2;
  }
  
  body {
    font-family: 'Roboto', 'Poppins', sans-serif;
    font-weight: 600;
    font-size: 0.8em;
    background: var(--background-color);
    color: var(--text-color);
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 0;
  }
  
  a {
    color: var(--text-color);
    text-decoration: none;
  }
  
  a:visited {
    color: var(--text-color);
  }
  
  .readmorebutton {
    background-color: SlateGray;
    border: none;
    color: var(--text-color);
    padding: 6px 8px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 11px;
    margin: 2px 1px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  
  .readmorebutton:hover {
    background-color: darkslategray;
  }
  
  .holder-of-the-divs {
    width: var(--screen-width);
    max-width: 1000px;
    padding: 20px;
    box-sizing: border-box;
  }
  
  /* Responsive Design */
  @media (max-width: 999px) {
    .alerts-container {
      max-width: 470px !important;
    }
    .holder-of-the-divs {
      max-width: 500px;
    }
    .sensor-container {
      font-size: smaller;
      flex-direction: column;
      align-items: center;
    }
    .radar-grid {
      grid-template-columns: 1fr;
      max-width: 470px;
    }
    .image-grid {
      grid-template-columns: 1fr;
      max-width: 470px !important;
    }
    .forecast-container {
      width: 100%;
      padding: 5px;
    }
    .forecast {
      width: 45%;
      padding: 15px;
    }
    p#windgusts,
    p#feelslike-temperature,
    p.wxelement {
      font-size: 0.9em;
    }
    .weather-icon {
      width: 40px;
      height: 40px;
    }
  }
  
  /* Alerts */
  .delays-container,
  .ground-stops {
    display: none;
    text-align: center;
    background-color: var(--alert-color);
    padding: 10px;
    border-radius: 5px;
  }
  
  .crosswind-alert {
    background-color: var(--crosswind-alert-color);
    color: var(--text-color);
    text-align: center;
    padding: 10px;
  }
  
  .weather-alert {
    background-color: var(--weather-alert-color);
    color: var(--text-color);
    text-align: center;
    padding: 10px;
    border-bottom: 1px solid #ffb627;
  }
  
  .radar-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-gap: 10px;
    width: 100%;
  }
  
  .radar-grid img {
    width: 100%;
    height: auto;
    object-fit: contain;
  }
  
  .meteos img {
    width: 33%;
    transition: width 1.3s ease-in-out;
  }
  
  .meteos img:hover {
    width: 100%;
  }
  
  .image-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-gap: 10px;
    max-width: 1057px;
    overflow: hidden;
  }
  
  .image-grid img {
    width: 100%;
    height: auto;
    object-fit: contain;
  }
  
  .image-grid .caption {
    padding: 0;
    margin: 0;
    font-size: 1.5em;
    background-color: rgba(70, 74, 80, 0.8);
    width: 100%;
    font-weight: 100;
    color: var(--text-color);
  }
  
  .sensor-container {
    display: flex;
    justify-content: space-between;
    margin: 10px 0;
  }
  
  .sensor-box {
    width: 17%;
    padding: 10px;
    box-sizing: border-box;
    background: linear-gradient(to bottom left, var(--secondary-color), #03730c);
    color: var(--text-color);
    border-radius: 8px;
    margin: 5px;
  }
  
  .sensor-box.IceWatch {
    background: repeating-linear-gradient(160deg, red, #e95e5e 100px);
  }
  
  .forecast-container {
    display: flex;
    justify-content: space-between;
    width: 80%;
    font-family: 'Poppins', 'Roboto', 'Open Sans', 'Segoe UI', 'Arial', sans-serif;
    color: #333;
    margin-bottom: 10px;
    padding: 10px;
    background-color: transparent;
  }
  
  .forecast {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 18%;
    background-color: #fff;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    margin: 5px;
  }
  
  .day {
    text-align: center;
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: 10px;
  }
  
  .weather-icon {
    width: 60px;
    height: 60px;
    margin-top: 10px;
  }
  
  .high-low {
    font-size: 2em;
    font-weight: 700;
    margin-top: 10px;
  }
  
  .weather-refresh {
    position: relative;
    background-color: rgba(0, 0, 0, 0.5);
    color: var(--text-color);
    padding: 5px 10px;
    border-radius: 5px;
    margin-top: -20px;
    margin-bottom: 10px;
  }
  
  .last-refresh {
    font-size: 12px;
  }
  
  .wind-indicator-container {
    width: 45px;
    height: 45px;
    border: 1px solid var(--text-color);
    position: relative;
    border-radius: 50%;
    background-color: #507595;
    margin-right: 5px;
  }
  
  .wind-arrow {
    width: 3px;
    height: 25px;
    background-color: var(--text-color);
    position: absolute;
    bottom: 50%;
    left: 50%;
    transform-origin: 50% 100%;
    transform: translateX(-50%) rotate(0deg);
    transition: transform 0.5s ease-in-out;
  }
  
  .wind.wxelement {
    height: 65px;
  }
  

  #weatherDataContainer {
    display: flex;
    /* use flexbox layout */
    width: 1020px;
    justify-content: space-between;
    margin-bottom: 10px;
}

.weather-point {
    width: 17%;
    margin-right: 2%;
    padding: 10px;
    box-sizing: border-box;
    background: linear-gradient(to bottom left, #33ad55, #03730c);
    color: white;

}

#ambientWeatherDataContainer {
    border-radius: 10px;
    display: flex;
    flex-direction: column; /* Display children in a column layout */
    align-items: center;
    background-color: #268ea3;    
    margin-bottom: 10px;
  }
  
/* Media query for smaller screens */
@media (max-width: 999px) { /* Adjust 999px to your needs */
    .forecast-container {
        flex-wrap: nowrap; /* Allows items to wrap to the next line */
        justify-content: center; /* Centers items when they wrap */
        padding: 5px; /* Reduce padding */
        width: 100%;
    }
    .forecast {
        width: 45%; /* Adjust width to have 2 items per row */
        margin: 5px; /* Adjust margins for spacing */
        padding: 15px; /* Reduce padding inside the cards */
    }
    .day, .high-low {
        font-size: 1em; /* Adjust font size down */
    }
    .weather-icon {
        width: 40px; /* Adjust icon size down */
        height: 40px; /* Adjust icon size down */
    }
    /* Your other elements' styles */
    p#windgusts {
        font-size: .9em;
    }
    p#feelslike-temperature {
        font-size: .9em;
    }
    p.wxelement {
        font-size: 12px;
    }

}


  .pws-box {
    display: flex; /* Display left and right boxes in a row */
    justify-content: space-between; /* Space between left and right boxes */
    color: white; /* Text color */
  }
  
  .pws-box-left,
  .pws-box-right {
    flex: 1; /* Equal width for both columns */
    padding: 10px; /* Padding for spacing */
    box-sizing: border-box; /* Include padding in the width calculation */
  }

  .wxelement {
    display: flex;
    align-items: center;
    font-size:20px;
    text-align: center;
  }

  p#feelslike-temperature {
    text-align: center;
}

p#windgusts {
    text-align: center;
}
  
  .wxelement img {
    width: 36px;
    margin-right: 10px; /* Add some space between the icon and text */
  }
  
img#uvimg {
    width: 50px;
}

  .wind.wxelement {
    height: 65px;
}

img#satellite {
    margin-bottom: -100px;
}

================================================================================

File Path: /Users/outjet/Sites/radarb/public/scripts/app1597.js
--------------------------------------------------------------------------------
// Configuration
const userLat = 41.48;
const userLng = -81.81;
const AMBIENT_WEATHER_API_URL = 'https://us-central1-radarb.cloudfunctions.net/getAmbientWeatherData';
const PIVOTAL_WEATHER_API_URL = 'https://us-central1-radarb.cloudfunctions.net/getPivotalHRRR6hQPF';
let isFirstRefresh = true;
let sensorDataDisplayed = false;
let cityName = ""; // Declare globally

// Utility Functions
function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371; // Earth's radius in km
  const dLat = toRadians(lat2 - lat1);
  const dLon = toRadians(lon2 - lon1);
  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
    Math.sin(dLon / 2) ** 2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  const d = R * c;
  return d;
}

function toRadians(degrees) {
  return degrees * Math.PI / 180;
}

// Event Listeners
window.addEventListener("load", initializeApp);
window.addEventListener("loadCameraData", handleCameraData);
window.addEventListener("loadSensorData", handleSensorData);

// Initialization Function
function initializeApp() {
  const forecastContainer = document.querySelector('.forecast-container');
  forecastContainer.innerHTML = 'Loading forecast...';

  const lat = userLat;
  const lng = userLng;
  const boxsize = 8;
  const latne = lat + boxsize / 69;
  const lngne = lng + boxsize / 53;
  const latsw = lat - boxsize / 69;
  const lngsw = lng - boxsize / 53;

  // Dispatch events to load camera and sensor data
  fetchData(latne, lngne, latsw, lngsw, lat, lng);

  // Fetch weather forecast
  getWeatherForecast(lat, lng);

  // Display meteograms after a short delay
  setTimeout(loadMeteograms, 3000);
}

function fetchData(latne, lngne, latsw, lngsw, lat, lng) {
  // Fetch camera and sensor data in parallel
  window.dispatchEvent(new CustomEvent("loadCameraData", {
    detail: { latne, lngne, latsw, lngsw, lat, lng }
  }));
  window.dispatchEvent(new CustomEvent("loadSensorData", {
    detail: { latne, lngne, latsw, lngsw, lat, lng }
  }));
}

async function handleCameraData(event) {
  const { latne, lngne, latsw, lngsw, lat, lng } = event.detail;
  try {
    const response = await fetch(`https://us-central1-radarb.cloudfunctions.net/getCameraData?latne=${latne}&lngne=${lngne}&latsw=${latsw}&lngsw=${lngsw}`);
    const data = await response.json();
    displayCameraData(data, lat, lng);
  } catch (error) {
    console.error('Error fetching camera data:', error);
  }
}

function displayCameraData(data, userLat, userLng) {
  const cameraDistances = data.results.map(camera => ({
    camera,
    distance: haversine(userLat, userLng, camera.latitude, camera.longitude)
  }));

  cameraDistances.sort((a, b) => a.distance - b.distance);

  const imageGrid = document.querySelector(".image-grid");
  imageGrid.innerHTML = ""; // Clear previous cameras

  cameraDistances.slice(0, 4).forEach(({ camera }) => {
    const div = document.createElement("div");
    const img = document.createElement("img");
    img.src = camera.cameraViews[0].smallUrl;
    img.alt = camera.description;
    img.loading = "lazy";

    const caption = document.createElement("div");
    caption.className = "caption";
    caption.textContent = camera.cameraViews[0].mainRoute.includes("Hilliard")
      ? 'I-90 between Hilliard/Mckinley'
      : camera.cameraViews[0].mainRoute;

    div.appendChild(img);
    div.appendChild(caption);
    imageGrid.appendChild(div);
  });
}

async function handleSensorData(event) {
  const { latne, lngne, latsw, lngsw, lat, lng } = event.detail;
  if (sensorDataDisplayed) return;
  try {
    const response = await fetch(`https://us-central1-radarb.cloudfunctions.net/getSensorData?latne=${latne}&lngne=${lngne}&latsw=${latsw}&lngsw=${lngsw}`);
    const data = await response.json();
    sensorDataDisplayed = true;
    displaySensorData(data, lat, lng);
    updateTime(lat, lng);
  } catch (error) {
    console.error('Error fetching sensor data:', error);
  }
}

function displaySensorData(data, lat, lng) {
  const sensorContainer = document.querySelector(".sensor-container");
  sensorContainer.innerHTML = ""; // Clear previous sensors

  const sensorDistances = data.results.flatMap(result => 
    result.surfaceSensors
      .filter(sensor => sensor.surfaceTemperature !== -9999999.0)
      .map(sensor => ({
        sensor,
        distance: haversine(lat, lng, sensor.latitude, sensor.longitude)
      }))
  );

  sensorDistances.sort((a, b) => a.distance - b.distance);

  sensorDistances.slice(0, 3).forEach(({ sensor }) => {
    const div = document.createElement("div");
    div.className = "sensor-box" + (sensor.status === "Ice Watch" ? " IceWatch" : "");
    div.innerHTML = `${sensor.name.slice(0, -4)}<br>`;
    if (sensor.description) div.innerHTML += `Description: ${sensor.description}<br>`;
    if (sensor.condition) div.innerHTML += `Condition: ${sensor.condition}<br>`;
    div.innerHTML += `Surface temp: ${sensor.surfaceTemperature}<br>Status: ${sensor.status}`;
    sensorContainer.appendChild(div);
  });

  if (data.results.length === 0) {
    const div = document.createElement("div");
    div.className = "sensor-box";
    div.textContent = "No sensor data returned from ODOT";
    sensorContainer.appendChild(div);
  }

  const forecastDiv = document.createElement("div");
  forecastDiv.className = "sensor-box";
  forecastDiv.style.backgroundColor = "#DDD";
  forecastDiv.innerHTML = `
    <a href='https://forecast.weather.gov/product.php?site=CLE&issuedby=CLE&product=AFD&format=CI&version=1&glossary=1&highlight=off' target='_blank'>Forecast discussion</a><br>
    <a href='https://icyroadsafety.com/lcr/' target='_blank'>Icy Road Forecast</a><br>
    <a href='http://wxmaps.org/pix/clegfs.png' target='_blank'>GFS</a>
    <a href='http://wxmaps.org/pix/clegfsb.png' target='_blank'>GFSLR</a>
    <a href='http://wxmaps.org/pix/clenam.png' target='_blank'>NAM</a>
  `;
  sensorContainer.appendChild(forecastDiv);

  const clocksDiv = document.createElement("div");
  clocksDiv.className = "sensor-box";
  clocksDiv.id = "clocks";
  clocksDiv.style.backgroundColor = "#DDD";
  clocksDiv.innerHTML = `
    <div><span id='local-time'>--:--:--</span> ET</div>
    <div><span id='refresh-paused' style='display:none;'>REFRESH PAUSED</span></div>
  `;
  sensorContainer.appendChild(clocksDiv);

  // Event Listener to Resume Refresh
  clocksDiv.addEventListener("click", () => {
    const refreshPaused = document.getElementById("refresh-paused");
    refreshPaused.style.display = "none";
    restartImageRefresh();
  });
}

function loadMeteograms() {
  const meteosDiv = document.querySelector('.meteos');
  const urlb = '&wfo=CLE&zcode=LEZ146&gset=20&gdiff=6&unit=0&tinfo=EY5&pcmd=10111110111110000000000000000000000000000000000000000000000&lg=en&indu=0!1!1!&dd=&bw=&hrspan=48&pqpfhr=6&psnwhr=6';
  const images = [
    { hour: 0, src: `https://marine.weather.gov/meteograms/Plotter.php?lat=${userLat}&lon=${userLng}&ahour=0${urlb}` },
    { hour: 48, src: `https://marine.weather.gov/meteograms/Plotter.php?lat=${userLat}&lon=${userLng}&ahour=48${urlb}` },
    { hour: 96, src: `https://marine.weather.gov/meteograms/Plotter.php?lat=${userLat}&lon=${userLng}&ahour=96${urlb}` },
  ];

  images.forEach(image => {
    const img = document.createElement("img");
    img.src = image.src;
    img.alt = `Meteogram for ${image.hour} hours`;
    img.loading = "lazy";
    meteosDiv.appendChild(img);
  });
}

function restartImageRefresh() {
  clearInterval(refreshIntervalId);
  refreshIntervalId = setInterval(() => {
    const images = document.querySelectorAll(".image-grid img");
    images.forEach(img => {
      const currentSrc = img.getAttribute("src").split('?')[0];
      img.src = `${currentSrc}?t=${Date.now()}`;
    });
  }, 4250);
}

// Weather Forecast
async function getWeatherForecast(lat, lng) {
  const forecastContainer = document.querySelector('.forecast-container');
  try {
    let data = getCachedWeatherData();
    if (!data) {
      data = await fetchWeatherData(lat, lng);
      cacheWeatherData(data);
    }

    renderWeatherForecast(data);
  } catch (error) {
    forecastContainer.innerHTML = 'Error loading forecast.';
    console.error(error);
  }
}

function getCachedWeatherData() {
  const cachedData = localStorage.getItem('weatherData');
  const cachedDataTime = localStorage.getItem('weatherDataTime');
  const currentTime = Date.now();
  if (cachedData && cachedDataTime && ((currentTime - cachedDataTime) / 1000 / 60 < 1)) {
    return JSON.parse(cachedData);
  }
  localStorage.removeItem('weatherData');
  localStorage.removeItem('weatherDataTime');
  return null;
}

async function fetchWeatherData(lat, lng) {
  const response = await fetch(`https://us-central1-radarb.cloudfunctions.net/getWeatherData?lat=${lat}&lng=${lng}`);
  if (!response.ok) throw new Error('Failed to fetch weather data');
  return await response.json();
}

function cacheWeatherData(data) {
  localStorage.setItem('weatherData', JSON.stringify(data));
  localStorage.setItem('weatherDataTime', Date.now());
}

function renderWeatherForecast(data) {
  const fiveDays = data.daily.slice(0, 5);
  const forecastContainer = document.querySelector('.forecast-container');
  forecastContainer.innerHTML = ''; // Clear loading message

  fiveDays.forEach(day => {
    const { dt, temp, weather } = day;
    const dayName = new Date(dt * 1000).toLocaleString('default', { weekday: 'short' });
    const high = temp.max.toFixed(0);
    const low = temp.min.toFixed(0);
    const iconCode = weather[0].icon;
    const iconUrl = `images/${iconCode}.png`;

    const forecastDiv = document.createElement("div");
    forecastDiv.className = "forecast";
    forecastDiv.innerHTML = `
      <div class="day">${dayName}</div>
      <div class="weather-icon-div"><img src="${iconUrl}" class="weather-icon" alt="Weather icon"></div>
      <div class="high-low">${high}/${low}</div>
    `;
    forecastContainer.appendChild(forecastDiv);
  });
}

// Meteogram Animation (Optional and Suspended for now)
/* 
function animateDynamicImages() {
  const baseUrl = 'https://x-hv1.pivotalweather.com/maps/rtma_ru/latest/series_';
  const imageExtension = '.png';
  const numImages = 36;
  const animationContainer = document.getElementById('animationContainer');
  let currentIndex = 0;

  function updateAnimationContainer() {
    const imageUrl = `${baseUrl}${String(currentIndex).padStart(3, '0')}/sfct-imp.us_state_oh${imageExtension}`;
    animationContainer.style.backgroundImage = `url(${imageUrl})`;
    currentIndex = (currentIndex + 1) % numImages;
  }

  setInterval(updateAnimationContainer, 1000);
}
*/

// Image Refresh
let refreshIntervalId = setInterval(restartImageRefresh, 4250);

// Function to fetch and update current weather
async function fetchWeatherDataFromStation() {
  try {
    const response = await fetch(AMBIENT_WEATHER_API_URL);
    if (!response.ok) throw new Error('Network response was not ok');
    const weatherData = await response.json();
    return weatherData[0].lastData;
  } catch (error) {
    console.error('Error fetching weather data from station:', error);
    throw error;
  }
}

async function updateCurrentWeather() {
  try {
    const currentWeather = await fetchWeatherDataFromStation();
    updateWeatherElements(currentWeather);
    lastRefreshTimestamp = Date.now();
    updateRefreshTimer();
  } catch (error) {
    console.error('Error updating current weather:', error);
  }
}

function updateWeatherElements(data) {
  const {
    tempf,
    feelsLike,
    humidity,
    windspeedmph,
    windgustmph,
    uv,
    winddir
  } = data;

  document.getElementById("current-temperature").textContent = `${tempf.toFixed(1)}°`;
  document.getElementById("feelslike-temperature").textContent = `Feels like ${feelsLike.toFixed(1)}°`;
  document.getElementById("humidity").textContent = `${humidity}%`;
  document.getElementById("wind").textContent = `${Math.round(windspeedmph)} mph`;
  document.getElementById("windgusts").textContent = `Gusts to ${Math.round(windgustmph)} mph`;
  document.getElementById("uv").textContent = `${Math.round(uv)}`;

  const windArrow = document.getElementById('windArrow');
  if (windArrow) {
    windArrow.style.transform = `translateX(-50%) rotate(${winddir}deg)`;
  }
}

document.querySelectorAll('div.last-refresh').forEach(div => {
  div.addEventListener('click', updateCurrentWeather);
});

// Initial Weather Update
updateCurrentWeather();

// Refresh Timer
let lastRefreshTimestamp = Date.now();

function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = seconds % 60;
  return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
}

function updateRefreshTimer() {
  const currentTime = Date.now();
  const elapsedSeconds = Math.floor((currentTime - lastRefreshTimestamp) / 1000);
  const timerElement = document.getElementById("refresh-timer");
  const timerContainer = document.querySelector(".weather-refresh");

  if (timerElement) {
    if (isFirstRefresh) {
      isFirstRefresh = false;
      timerContainer.style.display = "block";
    }

    timerElement.textContent = formatTime(elapsedSeconds);
  }
}

setInterval(updateRefreshTimer, 1000);

// Update Local Time and Fetch City Name
async function updateTime(lat, lng) {
  const localTime = new Date().toLocaleString("en-US", {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: true
  });
  document.getElementById("local-time").textContent = localTime;

  setInterval(() => {
    const localTime = new Date().toLocaleString("en-US", {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: true
    });
    document.getElementById("local-time").textContent = localTime;
  }, 1000);

  // Fetch and display city name
  if (!cityName) {
    try {
      const response = await fetchCityName(lat, lng);
      displayCityName(response, lat, lng);
    } catch (error) {
      console.error('Error fetching city name:', error);
    }
  }
}

async function fetchCityName(lat, lng) {
  const url = `https://us-central1-radarb.cloudfunctions.net/getCityName?lat=${lat}&lng=${lng}`;
  const cache = await caches.open("my-cache");
  const cachedResponse = await cache.match(url);
  if (cachedResponse) return await cachedResponse.json();
  
  const response = await fetch(url);
  if (!response.ok) throw new Error('Failed to fetch city name');
  return await response.json();
}

function displayCityName(data, lat, lng) {
  const youAreHereSpan = document.getElementById("you-are-here");
  const formattedAddress = data.address;
  const premiseType = data.premiseType;

  youAreHereSpan.innerHTML += `Found you at: <a href="https://ohgo.com/cleveland?lt=${lat}&ln=${lng}&z=13&ls=incident,incident-waze,dangerous-slowdown,camera,delay,weather,weather-roadsensors,sign" target="_blank">${formattedAddress}</a> - ${premiseType}<br><br>`;
}

window.dispatchEvent(new Event("updateTime"));

// Fetch Flight Delays and Ground Stops
window.addEventListener("load", () => {
  checkFlightDelays('KCLE');
  // Ground stops code is commented out as per original
});

function checkFlightDelays(airportCode) {
  fetch(`https://us-central1-radarb.cloudfunctions.net/getFlightDelays?airportCode=${airportCode}`)
    .then(response => response.text())
    .then(data => {
      if (data.length > 0) {
        const airportDelays = document.querySelector(".airportDelays");
        const delaysContainer = document.querySelector('.delays-container');
        airportDelays.textContent += `✈ ${data}`;
        delaysContainer.style.display = 'block';
      }
    })
    .catch(error => console.error('Error fetching flight delays:', error));
}

================================================================================

File Path: /Users/outjet/Sites/radarb/config.js
--------------------------------------------------------------------------------
module.exports = {
    googleMapsApiKey: process.env.GOOGLE_MAPS_API_KEY,
  };
================================================================================

File Path: /Users/outjet/Sites/radarb/firebase.json
--------------------------------------------------------------------------------
{
  "functions": [
    {
      "source": "functions",
      "codebase": "default",
      "ignore": [
        "node_modules",
        ".git",
        "firebase-debug.log",
        "firebase-debug.*.log"
      ]
    }
  ],
  "hosting": {
    "public": "public",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ]
  },
  "emulators": {
    "functions": {
      "port": 5005
    },
    "database": {
      "port": 4242
    },
    "hosting": {
      "port": 5400
    },
    "ui": {
      "enabled": true
    },
    "singleProjectMode": true
  }
}

================================================================================

